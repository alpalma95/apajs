(function(a,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(a=typeof globalThis<"u"?globalThis:a||self,b(a.apajs={}))})(this,function(a){"use strict";let{isArray:b}=Array,ne=e=>b(e)?e.map(t=>typeof t=="string"?document.createTextNode(t):t):typeof e=="string"?document.createTextNode(e):e,ie=(e,t)=>{window.customElements.define(e.tag,class extends HTMLElement{constructor(){super(),this.ctx={onInit:(l=()=>{})=>l(),onDestroy:(l=()=>{})=>l(),subscribers:[],getHost:()=>this,watch:(l,n)=>this.ctx.subscribers.push({attributeName:l,cb:n})},e.shadow&&this.attachShadow({mode:e.shadow})}static get observedAttributes(){return[e.observed]}connectedCallback(){let l={};this.getAttributeNames().forEach(i=>{i.startsWith(":")&&(l[i.slice(1)]=this.getAttribute(i))}),this.ctx.props=l;let n=ne(t(this.ctx)),o=this.shadowRoot??this;b(n)?n.forEach(i=>o.appendChild(i)):o.appendChild(n),this.ctx.onInit()}attributeChangedCallback(l,n,o){this.ctx.subscribers.forEach(({attributeName:i,cb:d})=>{l===i&&d(l,n,o)})}disconnectedCallback(){this.ctx.onDestroy()}})};function oe(e){for(var t,l,n=arguments,o=1,i="",d="",s=[0],r=function(f){o===1&&(f||(i=i.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?s.push(f?n[f]:i):o===3&&(f||i)?(s[1]=f?n[f]:i,o=2):o===2&&i==="..."&&f?s[2]=Object.assign(s[2]||{},n[f]):o===2&&i&&!f?(s[2]=s[2]||{})[i]=!0:o>=5&&(o===5?((s[2]=s[2]||{})[l]=f?i?i+n[f]:n[f]:i,o=6):(f||i)&&(s[2][l]+=f?i+n[f]:i)),i=""},c=0;c<e.length;c++){c&&(o===1&&r(),r(c));for(var _=0;_<e[c].length;_++)t=e[c][_],o===1?t==="<"?(r(),s=[s,"",null],o=3):i+=t:o===4?i==="--"&&t===">"?(o=1,i=""):i=t+i[0]:d?t===d?d="":i+=t:t==='"'||t==="'"?d=t:t===">"?(r(),o=1):o&&(t==="="?(o=5,l=i,i=""):t==="/"&&(o<5||e[c][_+1]===">")?(r(),o===3&&(s=s[0]),o=s,(s=s[0]).push(this.apply(null,o.slice(1))),o=0):t===" "||t==="	"||t===`
`||t==="\r"?(r(),o=2):i+=t),o===3&&i==="!--"&&(o=4,s=s[0])}return r(),s.length>2?s.slice(1):s[1]}let $=Object,p,u=$.getPrototypeOf,N=document,C,h,g,B={isConnected:1},se=1e3,w,F={},de=u(B),K=u(u),M=(e,t,l,n)=>(e??(setTimeout(l,n),new Set)).add(t),O=(e,t,l)=>{let n=h;h=t;try{return e(l)}catch(o){return console.error(o),l}finally{h=n}},T=e=>e.filter(t=>{var l;return(l=t._dom)==null?void 0:l.isConnected}),W=e=>w=M(w,e,()=>{for(let t of w)t._bindings=T(t._bindings),t._listeners=T(t._listeners);w=p},se),x={get val(){return h==null||h.add(this),this._val},get oldVal(){return h==null||h.add(this),this._oldVal},set val(e){let t=this;if(e!==t._val){t._val=e;let l=[...t._listeners=T(t._listeners)];for(let n of l)L(n.f,n.s,n._dom),n._dom=p;t._bindings.length?C=M(C,t,ce):t._oldVal=e}}},H=e=>({__proto__:x,_val:e,_oldVal:e,_bindings:[],_listeners:[]}),R=e=>u(e??0)===x,re=e=>R(e)?e.val:e,fe=e=>R(e)?e.oldVal:e,v=(e,t)=>{let l=new Set,n={f:e},o=g;g=[];let i=O(e,l,t);i=(i??N).nodeType?i:new Text(i);for(let d of l)W(d),d._bindings.push(n);for(let d of g)d._dom=i;return g=o,n._dom=i},L=(e,t=H(),l)=>{let n=new Set,o={f:e,s:t};o._dom=l??(g==null?void 0:g.push(o))??B,t.val=O(e,n);for(let i of n)W(i),i._listeners.push(o);return t},q=(e,...t)=>{for(let l of t.flat(1/0)){let n=u(l??0),o=n===x?v(()=>l.val):n===K?v(l):l;o!=p&&e.append(o)}return e},ae=e=>(e._isBindingFunc=1,e),z=e=>new Proxy((t,...l)=>{var d;let[n,...o]=u(l[0]??0)===de?l:[{},...l],i=e?N.createElementNS(e,t):N.createElement(t);for(let[s,r]of $.entries(n)){let c=I=>I?$.getOwnPropertyDescriptor(I,s)??c(u(I)):p,_=t+","+s,f=F[_]??(F[_]=((d=c(u(i)))==null?void 0:d.set)??0),G=f?f.bind(i):i.setAttribute.bind(i,s),le=u(r??0);le===x?v(()=>(G(r.val),i)):le===K&&(!s.startsWith("on")||r._isBindingFunc)?v(()=>(G(r()),i)):G(r)}return q(i,...o)},{get:(t,l)=>t.bind(p,l)}),J=(e,t)=>t?t!==e&&e.replaceWith(t):e.remove(),ce=()=>{let e=[...C].filter(t=>t._val!==t._oldVal);C=p;for(let t of new Set(e.flatMap(l=>l._bindings=T(l._bindings))))J(t._dom,v(t.f,t._dom)),t._dom=p;for(let t of e)t._oldVal=t._val},ue=(e,t)=>J(e,v(t,e));const Q={add:q,_:ae,tags:z(),tagsNS:z,state:H,val:re,oldVal:fe,derive:L,hydrate:ue};let{fromEntries:he,entries:U,keys:pe,getPrototypeOf:X}=Object,{get:ge,set:Y,deleteProperty:Z,ownKeys:ye}=Reflect,m=Symbol,{state:k,derive:_e,add:be,tags:De}=Q,ve=X(k()),P,me=1e3,j,y=m(),Se=m(),Ce=m(),A=m(),S=m(),V=m(),ee=e=>e!=null&&e[Ce]?_e(()=>E(e())):k(E(e)),E=e=>{if(!(e instanceof Object)||e[y])return e;let t=new Proxy((e[y]=he(U(e).map(([l,n])=>[l,ee(n)])),e[Se]=e,e[A]=[],e[S]=k(1),e),{get:(l,n)=>X(l[y][n]??0)===ve?l[y][n].val:(n==="length"&&l[S].val,ge(l,n,t)),set(l,n,o){let i=l[y];if(n in i)return i[n].val=E(o),1;let d=n in l;if(Y(l,n,o))return d||Y(i,n,ee(o))&&(++l[S].val,Te(t,n,i[n])),1},deleteProperty:(l,n)=>(Z(l[y],n)&&xe(l,n),Z(l,n)&&++l[S].val),ownKeys:l=>(l[S].val,ye(l))});return t},D=e=>e[A]=e[A].filter(t=>t._containerDom.isConnected),we=(e,t,l,n)=>()=>{let o=n(l,()=>delete e[t]);return o[V]=t,o},te=(e,t,l,{_containerDom:n,f:o},i)=>{if(be(n,we(e,t,l,o)),!i&&Array.isArray(e)&&t!=e.length-1){let d={};for(let r of n.childNodes)d[r[V]]=r;let s=n.firstChild;for(let r of pe(e))s===d[r]?s=s.nextSibling:n.insertBefore(d[r],s)}},Te=(e,t,l)=>D(e).forEach(te.bind(j,e,t,l)),xe=(e,t)=>{var l;for(let n of D(e))(l=[...n._containerDom.childNodes].find(o=>o[V]===t))==null||l.remove()},Pe=e=>(P??(P=(setTimeout(()=>(P.forEach(D),P=j),me),new Set))).add(e),Ae=(e,t,l)=>{let n={_containerDom:e(),f:l};t[A].push(n),Pe(t);for(let[o,i]of U(t[y]))te(t,o,i,n,1);return n._containerDom},{state:Ee,derive:$e,tags:Ne}=Q;function ke(e,t,...l){const n=Ne[e];return t?n(t,...l):n(...l)}const Ve=oe.bind(ke);a.defineComponent=ie,a.derive=$e,a.html=Ve,a.list=Ae,a.reactive=E,a.state=Ee,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
