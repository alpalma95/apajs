(function(d,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(d=typeof globalThis<"u"?globalThis:d||self,a(d.apajs={}))})(this,function(d){"use strict";let a=(e,...s)=>{let r=e.reduce((l,o,g)=>l+o+(s[g]??""),""),t=[...new DOMParser().parseFromString(r,"text/html").body.childNodes];return t.length===1?t[0]:t},m=(e,s)=>{let[r,i]=e.split("|");return[r.trim(),i==null?void 0:i.split(",").map(n=>{let t=n.trim();if(/^\'|^\"|^\`/.test(t)||t==="$event")return t==="$event"?t:t.slice(1,-1);try{return JSON.parse(t)}catch{return s[t]}})]},p=(e,s,r)=>{let[i,n]=m(s.getAttribute(e));if(!i in r.handlers)return;let t=r.handlers[i],l=e.slice(1);n?s.addEventListener(l,o=>n.at(0)==="$event"?t(o,...n.slice(1)):t(...n)):s.addEventListener(l,t)},b=(e,s)=>{let r=e.getAttribute("ref");r&&(r in s.$refs?s.$refs[r]=[s.$refs[r],e].flat(1/0):s.$refs[r]=e)},c=(e,s)=>{if(!e)return;const r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(n){return n.getAttributeNames().some(t=>t.startsWith("@")||t==="ref")?NodeFilter.FILTER_ACCEPT:n.tagName.includes("-")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}});let i=r.currentNode;for(;i=r.nextNode();)i.getAttributeNames().filter(n=>n.startsWith("@")||n==="ref").forEach(n=>{p(n,i,s),b(i,s)});e.shadowRoot!==null&&c(e.shadowRoot,s)},{isArray:y}=Array,E=(e,s)=>{y(s)?s.forEach(r=>typeof r=="string"?e.appendChild(document.createTextNode(r)):e.appendChild(r)):e.appendChild(typeof s=="string"?document.createTextNode(s):s)},N=(e,s)=>{window.customElements.define(e.tag,class extends HTMLElement{constructor(){super(),this.ctx={onInit:r=>{},onDestroy:()=>{},host:this,$refs:{},handlers:{},watch:(r,i,n)=>{}},e.shadow&&this.attachShadow({mode:e.shadow})}static get observedAttributes(){return e.observed}connectedCallback(){let r={};this.getAttributeNames().forEach(t=>{t.startsWith(":")&&(r[t.slice(1)]=this.getAttribute(t))}),this.ctx.props=r,this.ctx.handlers={};let i=s(this.ctx),n=this.shadowRoot??this;E(n,i),c(this,this.ctx),this.ctx.onInit(n)}attributeChangedCallback(r,i,n){this.ctx.watch(r,i,n)}disconnectedCallback(){this.ctx.onDestroy()}})},h=null,f=e=>(h=e,e()),u=e=>{let s=new Set,r=()=>{h!==null&&(s.add(h),h=null)},i=()=>{s.forEach(t=>t())},n=typeof e=="object"?Object.fromEntries(Object.entries(e).map(([t,l])=>[t,typeof l=="object"?u(l):l])):typeof e=="function"?{val:f(()=>e)}:{val:e};return new Proxy(n,{get(t,l){return r(),typeof t[l]=="function"?t[l]():t[l]},set(t,l,o){return t[l]=o,i(),!0}})};d.define=N,d.derive=f,d.html=a,d.stream=u,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
