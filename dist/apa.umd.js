(function(f,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(f=typeof globalThis<"u"?globalThis:f||self,c(f.apajs={}))})(this,function(f){"use strict";let c=(e,r)=>{let[t,s]=e.split("|");return[t.trim(),s==null?void 0:s.split(",").map(n=>{let i=n.trim();if(/^\'|^\"|^\`/.test(i)||i==="$event")return i==="$event"?i:i.slice(1,-1);try{return JSON.parse(i)}catch{return r[i]}})]},g=(e,r,t)=>{let[s,n]=c(r.getAttribute(e));if(!s in t.handlers)return;let i=t.handlers[s],a=e.slice(1);n?r.addEventListener(a,l=>n.at(0)==="$event"?i(l,...n.slice(1)):i(...n)):r.addEventListener(a,i)},w=(e,r)=>{let t=e.getAttribute("ref");if(t)if(t in r.$refs)if(r.$refs[t]instanceof HTMLElement){let s=r.$refs[t];r.$refs[t]=new Set,r.$refs[t].add(s).add(e)}else r.$refs[t].add(e);else r.$refs[t]=e},E=(e,r)=>{let t=e.getAttribute("ref");r.$refs[t]instanceof Set?r.$refs[t].delete(e):delete r.$refs[t]},u=(e,r)=>{e.getAttributeNames().filter(t=>t.startsWith(":")||t==="ref").forEach(t=>{t=="ref"&&w(e,r),t.startsWith(":")&&g(t,e,r)})},N=e=>{let r=e.parentElement;for(;(r=r.parentElement)&&!r.tagName.includes("-"););return r},y=e=>{let r=t=>{t.filter(n=>N(n.target)==e).forEach(n=>{if(n.type!=="childList")return;let{addedNodes:i,removedNodes:a}=n;a.length&&a.forEach(l=>{!l.tagName||!l.getAttribute("ref")||E(l,e.ctx)}),i.length&&i.forEach(async l=>{l.tagName&&(u(l,e.ctx),l.childNodes.length>0&&await p(l,e.ctx))})})};return new Promise(t=>{t(new MutationObserver(r))})},m=(e,r)=>{if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(n){return n.getAttributeNames().some(i=>i.startsWith(":")||i==="ref")?NodeFilter.FILTER_ACCEPT:n.tagName.includes("-")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}});let s=t.currentNode;for(;s=t.nextNode();)u(s,r);e.shadowRoot!==null&&m(e.shadowRoot,r)},p=(e,r)=>new Promise(t=>{m(e,r),t()}),A=(e,r,t={className:HTMLElement,tag:""})=>{window.customElements.get(e.tag)||window.customElements.define(e.tag,class extends t.className{constructor(){super(),this.ctx={onInit:s=>{},onDestroy:()=>{},host:this,$refs:{},handlers:{},watch:(s,n,i)=>{},props:{}},e.shadow&&(this.shadow=this.attachShadow({mode:e.shadow})),typeof e.onConstruct=="function"&&e.onConstruct(this)}static get observedAttributes(){return e.observed}connectedCallback(){let s={};this.getAttributeNames().forEach(a=>{let l=this.getAttribute(a);try{s[a]=JSON.parse(l)}catch{s[a]=l}}),this.ctx.props=s,this.ctx.handlers={};let n=this.shadowRoot??this,i=r(this.ctx);if(i&&(n.innerHTML=i),e.isStatic)this.ctx.onInit(n);else{(async()=>await p(this,this.ctx))();let a={childList:!0,subtree:!0};y(this).then(l=>{this.shadowRoot&&l.observe(this.shadowRoot,a),l.observe(this,a),this.ctx.onInit(n)})}}attributeChangedCallback(s,n,i){this.ctx.watch(s,n,i)}disconnectedCallback(){this.ctx.onDestroy()}},(()=>t.className!==HTMLElement?{extends:t==null?void 0:t.tag}:{})())},{isArray:T}=Array,R=(e,...r)=>{let t=r.map(s=>s instanceof HTMLElement?s.outerHTML:T(s)?s.join(" "):s);return e.reduce((s,n,i)=>s+n+(t[i]??""),"")},o=null,h=new WeakMap;class L{constructor(r){this.cb=r,this._set=new Set}unhook(){this._set.forEach(r=>r.delete(this))}}let b=e=>{o=new L(e),o.cb();let r=o;return o=null,r},$=(e,r)=>{if(o===null)return;let t;h.has(e)?t=h.get(e).get(r):h.set(e,new Map([[r,t=new Set]])),o._set.add(t),t.add(o)},C=(e,r)=>{if(!h.get(e))return;h.get(e).get(r).forEach(({cb:s})=>s())},v=e=>{if(Array.isArray(e)||typeof e!="function"&&typeof e!="object")return{val:e};if(typeof e=="function"){let r=d(1);return b(()=>r.val=e()),r}else return Object.fromEntries(Object.entries(e).map(([r,t])=>[r,typeof t=="object"||typeof t=="function"?d(t):t]))},d=e=>{let r=v(e);return new Proxy(r,{get(t,s,n){return $(t,s),Reflect.get(t,s,n)},set(t,s,n,i){return t[s]!==n&&(Reflect.set(t,s,n,i),C(t,s)),!0}})};f.define=A,f.hook=b,f.html=R,f.stream=d,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
