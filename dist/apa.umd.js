(function(d,o){typeof exports=="object"&&typeof module<"u"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(d=typeof globalThis<"u"?globalThis:d||self,o(d.apajs={}))})(this,function(d){"use strict";let o=(e,r)=>{let[t,l]=e.split("|");return[t.trim(),l==null?void 0:l.split(",").map(n=>{let s=n.trim();if(/^\'|^\"|^\`/.test(s)||s==="$event")return s==="$event"?s:s.slice(1,-1);try{return JSON.parse(s)}catch{return r[s]}})]},E=(e,r,t)=>{let[l,n]=o(r.getAttribute(e));if(!l in t.handlers)return;let s=t.handlers[l],i=e.slice(1);n?r.addEventListener(i,a=>n.at(0)==="$event"?s(a,...n.slice(1)):s(...n)):r.addEventListener(i,s)},w=(e,r)=>{let t=e.getAttribute("ref");if(t)if(t in r.$refs)if(r.$refs[t]instanceof HTMLElement){let l=r.$refs[t];r.$refs[t]=new Set,r.$refs[t].add(l).add(e)}else r.$refs[t].add(e);else r.$refs[t]=e},f=(e,r)=>{e.getAttributeNames().filter(t=>t.startsWith("@")||t==="ref").forEach(t=>{t=="ref"&&w(e,r),t.startsWith("@")&&E(t,e,r)})},y=e=>{let r=e.parentElement;for(;(r=r.parentElement)&&!r.tagName.includes("-"););return r},N=e=>{let r=t=>{t.filter(n=>y(n.target)==e).forEach(n=>{if(n.type!=="childList")return;let{addedNodes:s}=n;s.length&&s.forEach(async i=>{i.tagName&&(f(i,e.ctx),i.childNodes.length>0&&await u(i,e.ctx))})})};return new Promise(t=>{t(new MutationObserver(r))})},c=(e,r)=>{if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(n){return n.getAttributeNames().some(s=>s.startsWith("@")||s==="ref")?NodeFilter.FILTER_ACCEPT:n.tagName.includes("-")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}});let l=t.currentNode;for(;l=t.nextNode();)f(l,r);e.shadowRoot!==null&&c(e.shadowRoot,r)},u=(e,r)=>new Promise(t=>{c(e,r),t()}),{isArray:m}=Array,g=(e,r)=>{m(r)?r.forEach(t=>typeof t=="string"?e.appendChild(document.createTextNode(t)):e.appendChild(t)):e.appendChild(typeof r=="string"?document.createTextNode(r):r)},T=(e,r)=>{window.customElements.define(e.tag,class extends HTMLElement{constructor(){super(),this.ctx={onInit:t=>{},onDestroy:()=>{},host:this,$refs:{},handlers:{},watch:(t,l,n)=>{}},e.shadow&&this.attachShadow({mode:e.shadow})}static get observedAttributes(){return e.observed}connectedCallback(){let t={};this.getAttributeNames().forEach(i=>{i.startsWith(":")&&(t[i.slice(1)]=this.getAttribute(i))}),this.ctx.props=t,this.ctx.handlers={};let l=r(this.ctx),n=this.shadowRoot??this;g(n,l),(async()=>await u(this,this.ctx))(),this.ctx.onInit(n);let s={childList:!0,subtree:!0};N(this).then(i=>{this.shadowRoot&&i.observe(this.shadowRoot,s),i.observe(this,s)})}attributeChangedCallback(t,l,n){this.ctx.watch(t,l,n)}disconnectedCallback(){this.ctx.onDestroy()}})},v=(e,...r)=>{let t=r.map(a=>a instanceof HTMLElement?a.outerHTML:m(a)?a.join(" "):a),l=e.reduce((a,A,C)=>a+A+(t[C]??""),""),i=[...new DOMParser().parseFromString(l,"text/html").body.childNodes];return i.length===1?i[0]:i},h=null,p=e=>(h=e,e()),b=e=>{let r=new Set,t=()=>{h!==null&&(r.add(h),h=null)},l=()=>{r.forEach(s=>s())},n=typeof e=="object"?Object.fromEntries(Object.entries(e).map(([s,i])=>[s,typeof i=="object"?b(i):i])):typeof e=="function"?{val:p(()=>e)}:{val:e};return new Proxy(n,{get(s,i){return t(),typeof s[i]=="function"?s[i]():s[i]},set(s,i,a){return s[i]=a,l(),!0}})};d.define=T,d.derive=p,d.html=v,d.stream=b,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
