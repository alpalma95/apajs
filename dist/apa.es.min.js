let{isArray:t}=Array,{createTextNode:e}=document,{fromEntries:s,entries:n,keys:i}=Object,{parse:r}=JSON;class o extends HTMLElement{constructor(){super()}connectedCallback(){this.getAttributeNames().forEach((t=>{if(!t.startsWith(":"))return;let e={};e[t.slice(1)]=r(this.getAttribute(t)),this.ctx?this.ctx.props=e:this.props=e}));let s=this.shadowRoot?this.shadowRoot:this,n=(i=this.render(),t(i)?i.map((t=>"string"==typeof t?e(t):t)):"string"==typeof i?e(i):i);var i;t(n)?n.forEach((t=>s.appendChild(t))):s.appendChild(n),this.onInit()}attributeChangedCallback(t,e,s){t.startsWith(":")?this[t.slice(1)]=s:this[t]=s,this.watch(t.slice(1),r(e),r(s))}disconnectedCallback(){this.onDestroy()}watch(t,e,s){this.ctx.watch&&this.ctx.watch(t,e,s,this)}onInit(){this.ctx.onInit&&this.ctx.onInit(this)}onDestroy(){this.ctx.onDestroy&&this.ctx.onDestroy(this)}render(){return this.ctx.render(this.ctx)}}let l=(t,e,s={})=>{window.customElements.define(t,class extends o{static get observedAttributes(){return s.observed??[]}constructor(){super(),this.ctx=(t=>{for(let e of i(t))"function"==typeof t[e]&&(t[e]=t[e].bind(t));return t})(e),this.ctx.getHost=()=>this,s.shadow&&this.attachShadow({mode:s.shadow})}})};let a,d,c,h,f,u=Object,_=u.getPrototypeOf,p=document,g={isConnected:1},v={},b=_(g),m=_(_),y=(t,e,s,n)=>(t??(setTimeout(s,n),new Set)).add(e),w=(t,e,s)=>{let n=c;c=e;try{return t(s)}catch(t){return s}finally{c=n}},x=t=>t.filter((t=>{var e;return null==(e=t._dom)?void 0:e.isConnected})),C=t=>f=y(f,t,(()=>{for(let t of f)t._bindings=x(t._bindings),t._listeners=x(t._listeners);f=a}),1e3),S={get val(){return null==c||c.add(this),this._val},get oldVal(){return null==c||c.add(this),this._oldVal},set val(t){let e=this;if(t!==e._val){e._val=t;let s=[...e._listeners=x(e._listeners)];for(let t of s)O(t.f,t.s,t._dom),t._dom=a;e._bindings.length?d=y(d,e,W):e._oldVal=t}}},V=t=>({__proto__:S,_val:t,_oldVal:t,_bindings:[],_listeners:[]}),E=t=>_(t??0)===S,A=(t,e)=>{let s=new Set,n={f:t},i=h;h=[];let r=w(t,s,e);r=(r??p).nodeType?r:new Text(r);for(let t of s)C(t),t._bindings.push(n);for(let t of h)t._dom=r;return h=i,n._dom=r},O=(t,e=V(),s)=>{let n=new Set,i={f:t,s:e};i._dom=s??(null==h?void 0:h.push(i))??g,e.val=w(t,n);for(let t of n)C(t),t._listeners.push(i);return e},D=(t,...e)=>{for(let s of e.flat(1/0)){let e=_(s??0),n=e===S?A((()=>s.val)):e===m?A(s):s;n!=a&&t.append(n)}return t},N=t=>new Proxy(((e,...s)=>{var n;let[i,...r]=_(s[0]??0)===b?s:[{},...s],o=t?p.createElementNS(t,e):p.createElement(e);for(let[t,s]of u.entries(i)){let i=e=>e?u.getOwnPropertyDescriptor(e,t)??i(_(e)):a,r=e+","+t,l=v[r]??(v[r]=(null==(n=i(_(o)))?void 0:n.set)??0),d=l?l.bind(o):o.setAttribute.bind(o,t),c=_(s??0);c===S?A((()=>(d(s.val),o))):c!==m||t.startsWith("on")&&!s._isBindingFunc?d(s):A((()=>(d(s()),o)))}return D(o,...r)}),{get:(t,e)=>t.bind(a,e)}),T=(t,e)=>e?e!==t&&t.replaceWith(e):t.remove(),W=()=>{let t=[...d].filter((t=>t._val!==t._oldVal));d=a;for(let e of new Set(t.flatMap((t=>t._bindings=x(t._bindings)))))T(e._dom,A(e.f,e._dom)),e._dom=a;for(let e of t)e._oldVal=e._val};const j={add:D,_:t=>(t._isBindingFunc=1,t),tags:N(),tagsNS:N,state:V,val:t=>E(t)?t.val:t,oldVal:t=>E(t)?t.oldVal:t,derive:O,hydrate:(t,e)=>T(t,A(e,t))},{state:k,derive:I,tags:P}=j;const R=function(t){for(var e,s,n=arguments,i=1,r="",o="",l=[0],a=function(t){1===i&&(t||(r=r.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?l.push(t?n[t]:r):3===i&&(t||r)?(l[1]=t?n[t]:r,i=2):2===i&&"..."===r&&t?l[2]=Object.assign(l[2]||{},n[t]):2===i&&r&&!t?(l[2]=l[2]||{})[r]=!0:i>=5&&(5===i?((l[2]=l[2]||{})[s]=t?r?r+n[t]:n[t]:r,i=6):(t||r)&&(l[2][s]+=t?r+n[t]:r)),r=""},d=0;d<t.length;d++){d&&(1===i&&a(),a(d));for(var c=0;c<t[d].length;c++)e=t[d][c],1===i?"<"===e?(a(),l=[l,"",null],i=3):r+=e:4===i?"--"===r&&">"===e?(i=1,r=""):r=e+r[0]:o?e===o?o="":r+=e:'"'===e||"'"===e?o=e:">"===e?(a(),i=1):i&&("="===e?(i=5,s=r,r=""):"/"===e&&(i<5||">"===t[d][c+1])?(a(),3===i&&(l=l[0]),i=l,(l=l[0]).push(this.apply(null,i.slice(1))),i=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(a(),i=2):r+=e),3===i&&"!--"===r&&(i=4,l=l[0])}return a(),l.length>2?l.slice(1):l[1]}.bind((function(t,e,...s){const n=P[t];return e?n(e,...s):n(...s)}));let B=t=>"object"!=typeof t?k(t):s(n(t).map((([t,e])=>[t,B(e)])));export{o as ReactiveWC,l as defineComponent,I as derive,R as html,B as reactive,k as state};
//# sourceMappingURL=apa.min.js.map