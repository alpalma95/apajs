let e=(e,t,r)=>{let[s,n]=((e,t)=>{let[r,s]=e.split("|");return[r.trim(),null==s?void 0:s.split(",").map((e=>{let r=e.trim();if(/^\'|^\"|^\`/.test(r)||"$event"===r)return"$event"===r?r:r.slice(1,-1);try{return JSON.parse(r)}catch{return t[r]}}))]})(t.getAttribute(e));if(!s in r.handlers)return;let i=r.handlers[s],a=e.slice(1);n?t.addEventListener(a,(e=>"$event"===n.at(0)?i(e,...n.slice(1)):i(...n))):t.addEventListener(a,i)},t=(t,r)=>{t.getAttributeNames().filter((e=>e.startsWith("@")||"ref"===e)).forEach((s=>{"ref"==s&&((e,t)=>{let r=e.getAttribute("ref");if(r)if(r in t.$refs)if(t.$refs[r]instanceof HTMLElement){let s=t.$refs[r];t.$refs[r]=new Set,t.$refs[r].add(s).add(e)}else t.$refs[r].add(e);else t.$refs[r]=e})(t,r),s.startsWith("@")&&e(s,t,r)}))},r=(e,s)=>{if(!e)return;const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>e.getAttributeNames().some((e=>e.startsWith("@")||"ref"===e))?NodeFilter.FILTER_ACCEPT:e.tagName.includes("-")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let i=n.currentNode;for(;i=n.nextNode();)t(i,s);null!==e.shadowRoot&&r(e.shadowRoot,s)},s=(e,t)=>new Promise((s=>{r(e,t),s()})),{isArray:n}=Array,i=(e,r)=>{window.customElements.define(e.tag,class extends HTMLElement{constructor(){super(),this.ctx={onInit:e=>{},onDestroy:()=>{},host:this,$refs:{},handlers:{},watch:(e,t,r)=>{}},e.shadow&&this.attachShadow({mode:e.shadow})}static get observedAttributes(){return e.observed}connectedCallback(){let e={};this.getAttributeNames().forEach((t=>{t.startsWith(":")&&(e[t.slice(1)]=this.getAttribute(t))})),this.ctx.props=e,this.ctx.handlers={};let i=r(this.ctx),a=this.shadowRoot??this;((e,t)=>{n(t)?t.forEach((t=>"string"==typeof t?e.appendChild(document.createTextNode(t)):e.appendChild(t))):e.appendChild("string"==typeof t?document.createTextNode(t):t)})(a,i),(async()=>{await s(this,this.ctx)})(),this.ctx.onInit(a);let o={childList:!0,subtree:!0};(e=>{let r=r=>{r.filter((t=>(e=>{let t=e.parentElement;for(;(t=t.parentElement)&&!t.tagName.includes("-"););return t})(t.target)==e)).forEach((r=>{if("childList"!==r.type)return;let{addedNodes:n}=r;n.length&&n.forEach((async r=>{r.tagName&&(t(r,e.ctx),r.childNodes.length>0&&await s(r,e.ctx))}))}))};return new Promise((e=>{e(new MutationObserver(r))}))})(this).then((e=>{this.shadowRoot&&e.observe(this.shadowRoot,o),e.observe(this,o)}))}attributeChangedCallback(e,t,r){this.ctx.watch(e,t,r)}disconnectedCallback(){this.ctx.onDestroy()}})},a=(e,...t)=>{let r=t.map((e=>e instanceof HTMLElement?e.outerHTML:n(e)?e.join(" "):e)),s=e.reduce(((e,t,s)=>e+t+(r[s]??"")),""),i=[...(new DOMParser).parseFromString(s,"text/html").body.childNodes];return 1===i.length?i[0]:i},o=null,l=e=>(o=e,e()),d=e=>{let t=new Set,r="object"==typeof e?Object.fromEntries(Object.entries(e).map((([e,t])=>[e,"object"==typeof t?d(t):t]))):"function"==typeof e?{val:l((()=>e))}:{val:e};return new Proxy(r,{get:(e,r)=>(null!==o&&(t.add(o),o=null),"function"==typeof e[r]?e[r]():e[r]),set:(e,r,s)=>(e[r]=s,t.forEach((e=>e())),!0)})};export{i as define,l as derive,a as html,d as stream};
//# sourceMappingURL=apa.min.js.map