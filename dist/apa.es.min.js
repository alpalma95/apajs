let t=(t,...e)=>{let r=t.reduce(((t,r,s)=>t+r+(e[s]??"")),""),s=[...(new DOMParser).parseFromString(r,"text/html").body.childNodes];return 1===s.length?s[0]:s},e=(t,e,r)=>{let[s,i]=((t,e)=>{let[r,s]=t.split("|");return[r.trim(),null==s?void 0:s.split(",").map((t=>{let r=t.trim();if(/^\'|^\"|^\`/.test(r)||"$event"===r)return"$event"===r?r:r.slice(1,-1);try{return JSON.parse(r)}catch{return e[r]}}))]})(e.getAttribute(t));if(!s in r.handlers)return;let n=r.handlers[s],a=t.slice(1);i?e.addEventListener(a,(t=>"$event"===i.at(0)?n(t,...i.slice(1)):n(...i))):e.addEventListener(a,n)},r=(t,e)=>{let r=t.getAttribute("ref");r&&(r in e.$refs?e.$refs[r]=[e.$refs[r],t].flat(1/0):e.$refs[r]=t)},s=(t,i)=>{if(!t)return;const n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.getAttributeNames().some((t=>t.startsWith("@")||"ref"===t))?NodeFilter.FILTER_ACCEPT:t.tagName.includes("-")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let a=n.currentNode;for(;a=n.nextNode();)a.getAttributeNames().filter((t=>t.startsWith("@")||"ref"===t)).forEach((t=>{e(t,a,i),r(a,i)}));null!==t.shadowRoot&&s(t.shadowRoot,i)},{isArray:i}=Array,n=(t,e)=>{window.customElements.define(t.tag,class extends HTMLElement{constructor(){super(),this.ctx={onInit:t=>{},onDestroy:()=>{},host:this,$refs:{},handlers:{},watch:(t,e,r)=>{}},t.shadow&&this.attachShadow({mode:t.shadow})}static get observedAttributes(){return t.observed}connectedCallback(){let t={};this.getAttributeNames().forEach((e=>{e.startsWith(":")&&(t[e.slice(1)]=this.getAttribute(e))})),this.ctx.props=t,this.ctx.handlers={};let r=e(this.ctx),n=this.shadowRoot??this;((t,e)=>{i(e)?e.forEach((e=>"string"==typeof e?t.appendChild(document.createTextNode(e)):t.appendChild(e))):t.appendChild("string"==typeof e?document.createTextNode(e):e)})(n,r),s(this,this.ctx),this.ctx.onInit(n)}attributeChangedCallback(t,e,r){this.ctx.watch(t,e,r)}disconnectedCallback(){this.ctx.onDestroy()}})},a=null,o=t=>(a=t,t()),l=t=>{let e=new Set,r="object"==typeof t?Object.fromEntries(Object.entries(t).map((([t,e])=>[t,"object"==typeof e?l(e):e]))):"function"==typeof t?{val:o((()=>t))}:{val:t};return new Proxy(r,{get:(t,r)=>(null!==a&&(e.add(a),a=null),"function"==typeof t[r]?t[r]():t[r]),set:(t,r,s)=>(t[r]=s,e.forEach((t=>t())),!0)})};export{n as define,o as derive,t as html,l as stream};
//# sourceMappingURL=apa.min.js.map