let{isArray:t}=Array,{fromEntries:e,entries:n,keys:r}=Object,{parse:l}=JSON;class s extends HTMLElement{constructor(){super()}connectedCallback(){this.getAttributeNames().forEach((t=>{if(!t.startsWith(":"))return;let e={};e[t.slice(1)]=l(this.getAttribute(t)),this.ctx.props=e}));let e=this.shadowRoot??this,n=(r=this.ctx.render(this.ctx),t(r)?r.map((t=>"string"==typeof t?document.createTextNode(t):t)):"string"==typeof r?document.createTextNode(r):r);var r;t(n)?n.forEach((t=>e.appendChild(t))):e.appendChild(n),this.ctx.onInit&&this.ctx.onInit(this)}attributeChangedCallback(t,e,n){this.ctx.watch&&this.ctx.watch(t.slice(1),l(e),l(n),this)}disconnectedCallback(){this.ctx.onDestroy&&this.ctx.onDestroy(this)}}let i=(t,e,n={})=>{window.customElements.define(t,class extends s{static get observedAttributes(){return n.observed??[]}constructor(){super(),this.ctx=(t=>{for(let e of r(t))"function"==typeof t[e]&&(t[e]=t[e].bind(t));return t})(e),this.ctx.getHost=()=>this,n.shadow&&this.attachShadow({mode:n.shadow})}})};let o,a,d,c,f,h=Object,u=h.getPrototypeOf,_=document,v={isConnected:1},g={},p=u(v),m=u(u),b=(t,e,n,r)=>(t??(setTimeout(n,r),new Set)).add(e),y=(t,e,n)=>{let r=d;d=e;try{return t(n)}catch(t){return n}finally{d=r}},x=t=>t.filter((t=>{var e;return null==(e=t._dom)?void 0:e.isConnected})),w=t=>f=b(f,t,(()=>{for(let t of f)t._bindings=x(t._bindings),t._listeners=x(t._listeners);f=o}),1e3),C={get val(){return null==d||d.add(this),this._val},get oldVal(){return null==d||d.add(this),this._oldVal},set val(t){let e=this;if(t!==e._val){e._val=t;let n=[...e._listeners=x(e._listeners)];for(let t of n)A(t.f,t.s,t._dom),t._dom=o;e._bindings.length?a=b(a,e,D):e._oldVal=t}}},S=t=>({__proto__:C,_val:t,_oldVal:t,_bindings:[],_listeners:[]}),E=t=>u(t??0)===C,O=(t,e)=>{let n=new Set,r={f:t},l=c;c=[];let s=y(t,n,e);s=(s??_).nodeType?s:new Text(s);for(let t of n)w(t),t._bindings.push(r);for(let t of c)t._dom=s;return c=l,r._dom=s},A=(t,e=S(),n)=>{let r=new Set,l={f:t,s:e};l._dom=n??(null==c?void 0:c.push(l))??v,e.val=y(t,r);for(let t of r)w(t),t._listeners.push(l);return e},N=(t,...e)=>{for(let n of e.flat(1/0)){let e=u(n??0),r=e===C?O((()=>n.val)):e===m?O(n):n;r!=o&&t.append(r)}return t},V=t=>new Proxy(((e,...n)=>{var r;let[l,...s]=u(n[0]??0)===p?n:[{},...n],i=t?_.createElementNS(t,e):_.createElement(e);for(let[t,n]of h.entries(l)){let l=e=>e?h.getOwnPropertyDescriptor(e,t)??l(u(e)):o,s=e+","+t,a=g[s]??(g[s]=(null==(r=l(u(i)))?void 0:r.set)??0),d=a?a.bind(i):i.setAttribute.bind(i,t),c=u(n??0);c===C?O((()=>(d(n.val),i))):c!==m||t.startsWith("on")&&!n._isBindingFunc?d(n):O((()=>(d(n()),i)))}return N(i,...s)}),{get:(t,e)=>t.bind(o,e)}),P=(t,e)=>e?e!==t&&t.replaceWith(e):t.remove(),D=()=>{let t=[...a].filter((t=>t._val!==t._oldVal));a=o;for(let e of new Set(t.flatMap((t=>t._bindings=x(t._bindings)))))P(e._dom,O(e.f,e._dom)),e._dom=o;for(let e of t)e._oldVal=e._val};const T={add:N,_:t=>(t._isBindingFunc=1,t),tags:V(),tagsNS:V,state:S,val:t=>E(t)?t.val:t,oldVal:t=>E(t)?t.oldVal:t,derive:A,hydrate:(t,e)=>P(t,O(e,t))};let{fromEntries:j,entries:k,keys:B,getPrototypeOf:W}=Object,{get:F,set:H,deleteProperty:I,ownKeys:K}=Reflect,M=Symbol,{state:R,derive:J,add:L,tags:$}=T,q=W(R()),z=M(),G=M(),Q=M(),U=M(),X=M(),Y=M(),Z=t=>null!=t&&t[Q]?J((()=>tt(t()))):R(tt(t)),tt=t=>{if(!(t instanceof Object)||t[z])return t;let e=new Proxy((t[z]=j(k(t).map((([t,e])=>[t,Z(e)]))),t[G]=t,t[U]=[],t[X]=R(1),t),{get:(t,n)=>W(t[z][n]??0)===q?t[z][n].val:("length"===n&&t[X].val,F(t,n,e)),set(t,n,r){let l=t[z];if(n in l)return l[n].val=tt(r),1;let s=n in t;return H(t,n,r)?(s||H(l,n,Z(r))&&(++t[X].val,rt(e,n,l[n])),1):void 0},deleteProperty:(t,e)=>(I(t[z],e)&&lt(t,e),I(t,e)&&++t[X].val),ownKeys:t=>(t[X].val,K(t))});return e},et=t=>t[U]=t[U].filter((t=>t._containerDom.isConnected)),nt=(t,e,n,{_containerDom:r,f:l},s)=>{if(L(r,((t,e,n,r)=>()=>{let l=r(n,(()=>delete t[e]));return l[Y]=e,l})(t,e,n,l)),!s&&Array.isArray(t)&&e!=t.length-1){let e={};for(let t of r.childNodes)e[t[Y]]=t;let n=r.firstChild;for(let l of B(t))n===e[l]?n=n.nextSibling:r.insertBefore(e[l],n)}},rt=(t,e,n)=>et(t).forEach(nt.bind(undefined,t,e,n)),lt=(t,e)=>{var n;for(let r of et(t))null==(n=[...r._containerDom.childNodes].find((t=>t[Y]===e)))||n.remove()},{state:st,derive:it,tags:ot}=T;const at=function(t){for(var e,n,r=arguments,l=1,s="",i="",o=[0],a=function(t){1===l&&(t||(s=s.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?o.push(t?r[t]:s):3===l&&(t||s)?(o[1]=t?r[t]:s,l=2):2===l&&"..."===s&&t?o[2]=Object.assign(o[2]||{},r[t]):2===l&&s&&!t?(o[2]=o[2]||{})[s]=!0:l>=5&&(5===l?((o[2]=o[2]||{})[n]=t?s?s+r[t]:r[t]:s,l=6):(t||s)&&(o[2][n]+=t?s+r[t]:s)),s=""},d=0;d<t.length;d++){d&&(1===l&&a(),a(d));for(var c=0;c<t[d].length;c++)e=t[d][c],1===l?"<"===e?(a(),o=[o,"",null],l=3):s+=e:4===l?"--"===s&&">"===e?(l=1,s=""):s=e+s[0]:i?e===i?i="":s+=e:'"'===e||"'"===e?i=e:">"===e?(a(),l=1):l&&("="===e?(l=5,n=s,s=""):"/"===e&&(l<5||">"===t[d][c+1])?(a(),3===l&&(o=o[0]),l=o,(o=o[0]).push(this.apply(null,l.slice(1))),l=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(a(),l=2):s+=e),3===l&&"!--"===s&&(l=4,o=o[0])}return a(),o.length>2?o.slice(1):o[1]}.bind((function(t,e,...n){const r=ot[t];return e?r(e,...n):r(...n)}));export{i as defineComponent,it as derive,at as html,tt as reactive,st as state};
//# sourceMappingURL=apa.min.js.map