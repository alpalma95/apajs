let t=(t,e,s)=>{let[r,n]=((t,e)=>{let[s,r]=t.split("|");return[s.trim(),null==r?void 0:r.split(",").map((t=>{let s=t.trim();if(/^\'|^\"|^\`/.test(s)||"$event"===s)return"$event"===s?s:s.slice(1,-1);try{return JSON.parse(s)}catch{return e[s]}}))]})(e.getAttribute(t));if(!r in s.handlers)return;let a=s.handlers[r],i=t.slice(1);n?e.addEventListener(i,(t=>"$event"===n.at(0)?a(t,...n.slice(1)):a(...n))):e.addEventListener(i,a)},e=(e,s)=>{e.getAttributeNames().filter((t=>t.startsWith(":")||"ref"===t)).forEach((r=>{"ref"==r&&((t,e)=>{let s=t.getAttribute("ref");if(s)if(s in e.$refs)if(e.$refs[s]instanceof HTMLElement){let r=e.$refs[s];e.$refs[s]=new Set,e.$refs[s].add(r).add(t)}else e.$refs[s].add(t);else e.$refs[s]=t})(e,s),r.startsWith(":")&&t(r,e,s)}))},s=t=>{let s=s=>{s.filter((e=>(t=>{let e=t.parentElement;for(;(e=e.parentElement)&&!e.tagName.includes("-"););return e})(e.target)==t)).forEach((s=>{if("childList"!==s.type)return;let{addedNodes:r,removedNodes:a}=s;a.length&&a.forEach((e=>{!e.tagName||!e.getAttribute("ref")||((t,e)=>{let s=t.getAttribute("ref");e.$refs[s]instanceof Set?e.$refs[s].delete(t):delete e.$refs[s]})(e,t.ctx)})),r.length&&r.forEach((async s=>{s.tagName&&(e(s,t.ctx),s.childNodes.length>0&&await n(s,t.ctx))}))}))};return new Promise((t=>{t(new MutationObserver(s))}))},r=(t,s)=>{if(!t)return;const n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.getAttributeNames().some((t=>t.startsWith(":")||"ref"===t))?NodeFilter.FILTER_ACCEPT:t.tagName.includes("-")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let a=n.currentNode;for(;a=n.nextNode();)e(a,s);null!==t.shadowRoot&&r(t.shadowRoot,s)},n=(t,e)=>new Promise((s=>{r(t,e),s()})),a=(t,e,r={className:HTMLElement,tag:""})=>{window.customElements.get(t.tag)||window.customElements.define(t.tag,class extends r.className{constructor(){super(),this.ctx={onInit:t=>{},onDestroy:()=>{},host:this,$refs:{},handlers:{},watch:(t,e,s)=>{},props:{}},t.shadow&&(this.shadow=this.attachShadow({mode:t.shadow})),"function"==typeof t.onConstruct&&t.onConstruct(this)}static get observedAttributes(){return t.observed}connectedCallback(){let r={};this.getAttributeNames().forEach((t=>{let e=this.getAttribute(t);try{r[t]=JSON.parse(e)}catch{r[t]=e}})),this.ctx.props=r,this.ctx.handlers={};let a=this.shadowRoot??this,i=e(this.ctx);if(i&&(a.innerHTML=i),t.isStatic)this.ctx.onInit(a);else{(async()=>{await n(this,this.ctx)})();let t={childList:!0,subtree:!0};s(this).then((e=>{this.shadowRoot&&e.observe(this.shadowRoot,t),e.observe(this,t),this.ctx.onInit(a)}))}}attributeChangedCallback(t,e,s){this.ctx.watch(t,e,s)}disconnectedCallback(){this.ctx.onDestroy()}},r.className!==HTMLElement?{extends:null==r?void 0:r.tag}:{})},{isArray:i}=Array,o=(t,...e)=>{let s=e.map((t=>t instanceof HTMLElement?t.outerHTML:i(t)?t.join(" "):t));return t.reduce(((t,e,r)=>t+e+(s[r]??"")),"")},l=null,c=new WeakMap;class h{constructor(t){this.cb=t,this._set=new Set}unhook(){this._set.forEach((t=>t.delete(this)))}}let d=t=>{l=new h(t),l.cb();let e=l;return l=null,e},f=t=>{let e=(t=>{if(Array.isArray(t)||"function"!=typeof t&&"object"!=typeof t)return{val:t};if("function"==typeof t){let e=f(1);return d((()=>e.val=t())),e}return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,"object"==typeof e||"function"==typeof e?f(e):e])))})(t);return new Proxy(e,{get:(t,e,s)=>(((t,e)=>{if(null===l)return;let s;c.has(t)?s=c.get(t).get(e):c.set(t,new Map([[e,s=new Set]])),l._set.add(s),s.add(l)})(t,e),Reflect.get(t,e,s)),set:(t,e,s,r)=>(t[e]!==s&&(Reflect.set(t,e,s,r),((t,e)=>{c.get(t)&&c.get(t).get(e).forEach((({cb:t})=>t()))})(t,e)),!0)})};export{a as define,d as hook,o as html,f as stream};
//# sourceMappingURL=apa.min.js.map