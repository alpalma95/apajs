let{isArray:t}=Array,{createTextNode:e}=document,{fromEntries:n,entries:s,keys:r}=Object,{parse:i}=JSON;class l extends HTMLElement{constructor(){super()}connectedCallback(){this.getAttributeNames().forEach((t=>{if(!t.startsWith(":"))return;let e={};e[t.slice(1)]=i(this.getAttribute(t)),this.ctx?this.ctx.props=e:this.props=e}));let n=this.shadowRoot?this.shadowRoot:this,s=(r=this.render(),t(r)?r.map((t=>"string"==typeof t?e(t):t)):"string"==typeof r?e(r):r);var r;t(s)?s.forEach((t=>n.appendChild(t))):n.appendChild(s),this.onInit()}attributeChangedCallback(t,e,n){t.startsWith(":")?this[t.slice(1)]=n:this[t]=n,this.watch(t.slice(1),i(e),i(n))}disconnectedCallback(){this.onDestroy()}watch(t,e,n){this.ctx.watch&&this.ctx.watch(t,e,n,this)}onInit(){this.ctx.onInit&&this.ctx.onInit(this)}onDestroy(){this.ctx.onDestroy&&this.ctx.onDestroy(this)}render(){return this.ctx.render(this.ctx)}}let o=(t,e,n={})=>{window.customElements.define(t,class extends l{static get observedAttributes(){return n.observed??[]}constructor(){super(),this.ctx=(t=>{for(let e of r(t))"function"==typeof t[e]&&(t[e]=t[e].bind(t));return t})(e),this.ctx.getHost=()=>this,n.shadow&&this.attachShadow({mode:n.shadow})}})};let a,d,c,h,f,u=Object,_=u.getPrototypeOf,v=document,p={isConnected:1},g={},m=_(p),b=_(_),y=(t,e,n,s)=>(t??(setTimeout(n,s),new Set)).add(e),w=(t,e,n)=>{let s=c;c=e;try{return t(n)}catch(t){return n}finally{c=s}},x=t=>t.filter((t=>{var e;return null==(e=t._dom)?void 0:e.isConnected})),C=t=>f=y(f,t,(()=>{for(let t of f)t._bindings=x(t._bindings),t._listeners=x(t._listeners);f=a}),1e3),S={get val(){return null==c||c.add(this),this._val},get oldVal(){return null==c||c.add(this),this._oldVal},set val(t){let e=this;if(t!==e._val){e._val=t;let n=[...e._listeners=x(e._listeners)];for(let t of n)D(t.f,t.s,t._dom),t._dom=a;e._bindings.length?d=y(d,e,j):e._oldVal=t}}},E=t=>({__proto__:S,_val:t,_oldVal:t,_bindings:[],_listeners:[]}),O=t=>_(t??0)===S,A=(t,e)=>{let n=new Set,s={f:t},r=h;h=[];let i=w(t,n,e);i=(i??v).nodeType?i:new Text(i);for(let t of n)C(t),t._bindings.push(s);for(let t of h)t._dom=i;return h=r,s._dom=i},D=(t,e=E(),n)=>{let s=new Set,r={f:t,s:e};r._dom=n??(null==h?void 0:h.push(r))??p,e.val=w(t,s);for(let t of s)C(t),t._listeners.push(r);return e},V=(t,...e)=>{for(let n of e.flat(1/0)){let e=_(n??0),s=e===S?A((()=>n.val)):e===b?A(n):n;s!=a&&t.append(s)}return t},N=t=>new Proxy(((e,...n)=>{var s;let[r,...i]=_(n[0]??0)===m?n:[{},...n],l=t?v.createElementNS(t,e):v.createElement(e);for(let[t,n]of u.entries(r)){let r=e=>e?u.getOwnPropertyDescriptor(e,t)??r(_(e)):a,i=e+","+t,o=g[i]??(g[i]=(null==(s=r(_(l)))?void 0:s.set)??0),d=o?o.bind(l):l.setAttribute.bind(l,t),c=_(n??0);c===S?A((()=>(d(n.val),l))):c!==b||t.startsWith("on")&&!n._isBindingFunc?d(n):A((()=>(d(n()),l)))}return V(l,...i)}),{get:(t,e)=>t.bind(a,e)}),P=(t,e)=>e?e!==t&&t.replaceWith(e):t.remove(),j=()=>{let t=[...d].filter((t=>t._val!==t._oldVal));d=a;for(let e of new Set(t.flatMap((t=>t._bindings=x(t._bindings)))))P(e._dom,A(e.f,e._dom)),e._dom=a;for(let e of t)e._oldVal=e._val};const k={add:V,_:t=>(t._isBindingFunc=1,t),tags:N(),tagsNS:N,state:E,val:t=>O(t)?t.val:t,oldVal:t=>O(t)?t.oldVal:t,derive:D,hydrate:(t,e)=>P(t,A(e,t))};let{fromEntries:T,entries:W,keys:I,getPrototypeOf:R}=Object,{get:B,set:F,deleteProperty:H,ownKeys:K}=Reflect,M=Symbol,{state:J,derive:L,add:$,tags:q}=k,z=R(J()),G=M(),Q=M(),U=M(),X=M(),Y=M(),Z=M(),tt=t=>null!=t&&t[U]?L((()=>et(t()))):J(et(t)),et=t=>{if(!(t instanceof Object)||t[G])return t;let e=new Proxy((t[G]=T(W(t).map((([t,e])=>[t,tt(e)]))),t[Q]=t,t[X]=[],t[Y]=J(1),t),{get:(t,n)=>R(t[G][n]??0)===z?t[G][n].val:("length"===n&&t[Y].val,B(t,n,e)),set(t,n,s){let r=t[G];if(n in r)return r[n].val=et(s),1;let i=n in t;return F(t,n,s)?(i||F(r,n,tt(s))&&(++t[Y].val,rt(e,n,r[n])),1):void 0},deleteProperty:(t,e)=>(H(t[G],e)&&it(t,e),H(t,e)&&++t[Y].val),ownKeys:t=>(t[Y].val,K(t))});return e},nt=t=>t[X]=t[X].filter((t=>t._containerDom.isConnected)),st=(t,e,n,{_containerDom:s,f:r},i)=>{if($(s,((t,e,n,s)=>()=>{let r=s(n,(()=>delete t[e]));return r[Z]=e,r})(t,e,n,r)),!i&&Array.isArray(t)&&e!=t.length-1){let e={};for(let t of s.childNodes)e[t[Z]]=t;let n=s.firstChild;for(let r of I(t))n===e[r]?n=n.nextSibling:s.insertBefore(e[r],n)}},rt=(t,e,n)=>nt(t).forEach(st.bind(undefined,t,e,n)),it=(t,e)=>{var n;for(let s of nt(t))null==(n=[...s._containerDom.childNodes].find((t=>t[Z]===e)))||n.remove()},{state:lt,derive:ot,tags:at}=k;const dt=function(t){for(var e,n,s=arguments,r=1,i="",l="",o=[0],a=function(t){1===r&&(t||(i=i.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?o.push(t?s[t]:i):3===r&&(t||i)?(o[1]=t?s[t]:i,r=2):2===r&&"..."===i&&t?o[2]=Object.assign(o[2]||{},s[t]):2===r&&i&&!t?(o[2]=o[2]||{})[i]=!0:r>=5&&(5===r?((o[2]=o[2]||{})[n]=t?i?i+s[t]:s[t]:i,r=6):(t||i)&&(o[2][n]+=t?i+s[t]:i)),i=""},d=0;d<t.length;d++){d&&(1===r&&a(),a(d));for(var c=0;c<t[d].length;c++)e=t[d][c],1===r?"<"===e?(a(),o=[o,"",null],r=3):i+=e:4===r?"--"===i&&">"===e?(r=1,i=""):i=e+i[0]:l?e===l?l="":i+=e:'"'===e||"'"===e?l=e:">"===e?(a(),r=1):r&&("="===e?(r=5,n=i,i=""):"/"===e&&(r<5||">"===t[d][c+1])?(a(),3===r&&(o=o[0]),r=o,(o=o[0]).push(this.apply(null,r.slice(1))),r=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(a(),r=2):i+=e),3===r&&"!--"===i&&(r=4,o=o[0])}return a(),o.length>2?o.slice(1):o[1]}.bind((function(t,e,...n){const s=at[t];return e?s(e,...n):s(...n)}));export{l as ReactiveWC,o as defineComponent,ot as derive,dt as html,et as reactive,lt as state};
//# sourceMappingURL=apa.min.js.map