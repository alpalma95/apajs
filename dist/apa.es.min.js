let{isArray:t}=Array,{fromEntries:e,entries:n,keys:r}=Object,{parse:s}=JSON;class l extends HTMLElement{constructor(){super(),this.ctx={}}connectedCallback(){this.getAttributeNames().forEach((t=>{if(!t.startsWith(":"))return;let e={};e[t.slice(1)]=s(this.getAttribute(t)),this.ctx.props=e}));let e=this.shadowRoot??this,n=(r=this.ctx.render(this.ctx),t(r)?r.map((t=>"string"==typeof t?document.createTextNode(t):t)):"string"==typeof r?document.createTextNode(r):r);var r;t(n)?n.forEach((t=>e.appendChild(t))):e.appendChild(n),this.ctx.onInit&&this.ctx.onInit(this)}attributeChangedCallback(t,e,n){this.ctx.watch&&this.ctx.watch(t.slice(1),s(e),s(n),this)}disconnectedCallback(){this.ctx.onDestroy&&this.ctx.onDestroy(this)}}let i=(t,e,n={})=>{window.customElements.define(t,class extends l{static get observedAttributes(){return n.observed??[]}constructor(){super(),this.ctx=(t=>{for(let e of r(t))"function"==typeof t[e]&&(t[e]=t[e].bind(t));return t})(e),this.ctx.getHost=()=>this,n.shadow&&this.attachShadow({mode:n.shadow})}})};let o,a,d,c,f,h=Object,u=h.getPrototypeOf,_=document,v={isConnected:1},g={},p=u(v),m=u(u),b=(t,e,n,r)=>(t??(setTimeout(n,r),new Set)).add(e),y=(t,e,n)=>{let r=d;d=e;try{return t(n)}catch(t){return n}finally{d=r}},x=t=>t.filter((t=>{var e;return null==(e=t._dom)?void 0:e.isConnected})),w=t=>f=b(f,t,(()=>{for(let t of f)t._bindings=x(t._bindings),t._listeners=x(t._listeners);f=o}),1e3),C={get val(){return null==d||d.add(this),this._val},get oldVal(){return null==d||d.add(this),this._oldVal},set val(t){let e=this;if(t!==e._val){e._val=t;let n=[...e._listeners=x(e._listeners)];for(let t of n)A(t.f,t.s,t._dom),t._dom=o;e._bindings.length?a=b(a,e,D):e._oldVal=t}}},S=t=>({__proto__:C,_val:t,_oldVal:t,_bindings:[],_listeners:[]}),E=t=>u(t??0)===C,O=(t,e)=>{let n=new Set,r={f:t},s=c;c=[];let l=y(t,n,e);l=(l??_).nodeType?l:new Text(l);for(let t of n)w(t),t._bindings.push(r);for(let t of c)t._dom=l;return c=s,r._dom=l},A=(t,e=S(),n)=>{let r=new Set,s={f:t,s:e};s._dom=n??(null==c?void 0:c.push(s))??v,e.val=y(t,r);for(let t of r)w(t),t._listeners.push(s);return e},N=(t,...e)=>{for(let n of e.flat(1/0)){let e=u(n??0),r=e===C?O((()=>n.val)):e===m?O(n):n;r!=o&&t.append(r)}return t},V=t=>new Proxy(((e,...n)=>{var r;let[s,...l]=u(n[0]??0)===p?n:[{},...n],i=t?_.createElementNS(t,e):_.createElement(e);for(let[t,n]of h.entries(s)){let s=e=>e?h.getOwnPropertyDescriptor(e,t)??s(u(e)):o,l=e+","+t,a=g[l]??(g[l]=(null==(r=s(u(i)))?void 0:r.set)??0),d=a?a.bind(i):i.setAttribute.bind(i,t),c=u(n??0);c===C?O((()=>(d(n.val),i))):c!==m||t.startsWith("on")&&!n._isBindingFunc?d(n):O((()=>(d(n()),i)))}return N(i,...l)}),{get:(t,e)=>t.bind(o,e)}),P=(t,e)=>e?e!==t&&t.replaceWith(e):t.remove(),D=()=>{let t=[...a].filter((t=>t._val!==t._oldVal));a=o;for(let e of new Set(t.flatMap((t=>t._bindings=x(t._bindings)))))P(e._dom,O(e.f,e._dom)),e._dom=o;for(let e of t)e._oldVal=e._val};const T={add:N,_:t=>(t._isBindingFunc=1,t),tags:V(),tagsNS:V,state:S,val:t=>E(t)?t.val:t,oldVal:t=>E(t)?t.oldVal:t,derive:A,hydrate:(t,e)=>P(t,O(e,t))};let{fromEntries:j,entries:k,keys:B,getPrototypeOf:W}=Object,{get:F,set:H,deleteProperty:I,ownKeys:K}=Reflect,M=Symbol,{state:R,derive:J,add:L,tags:$}=T,q=W(R()),z=M(),G=M(),Q=M(),U=M(),X=M(),Y=M(),Z=t=>null!=t&&t[Q]?J((()=>tt(t()))):R(tt(t)),tt=t=>{if(!(t instanceof Object)||t[z])return t;let e=new Proxy((t[z]=j(k(t).map((([t,e])=>[t,Z(e)]))),t[G]=t,t[U]=[],t[X]=R(1),t),{get:(t,n)=>W(t[z][n]??0)===q?t[z][n].val:("length"===n&&t[X].val,F(t,n,e)),set(t,n,r){let s=t[z];if(n in s)return s[n].val=tt(r),1;let l=n in t;return H(t,n,r)?(l||H(s,n,Z(r))&&(++t[X].val,rt(e,n,s[n])),1):void 0},deleteProperty:(t,e)=>(I(t[z],e)&&st(t,e),I(t,e)&&++t[X].val),ownKeys:t=>(t[X].val,K(t))});return e},et=t=>t[U]=t[U].filter((t=>t._containerDom.isConnected)),nt=(t,e,n,{_containerDom:r,f:s},l)=>{if(L(r,((t,e,n,r)=>()=>{let s=r(n,(()=>delete t[e]));return s[Y]=e,s})(t,e,n,s)),!l&&Array.isArray(t)&&e!=t.length-1){let e={};for(let t of r.childNodes)e[t[Y]]=t;let n=r.firstChild;for(let s of B(t))n===e[s]?n=n.nextSibling:r.insertBefore(e[s],n)}},rt=(t,e,n)=>et(t).forEach(nt.bind(undefined,t,e,n)),st=(t,e)=>{var n;for(let r of et(t))null==(n=[...r._containerDom.childNodes].find((t=>t[Y]===e)))||n.remove()},{state:lt,derive:it,tags:ot}=T;const at=function(t){for(var e,n,r=arguments,s=1,l="",i="",o=[0],a=function(t){1===s&&(t||(l=l.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?o.push(t?r[t]:l):3===s&&(t||l)?(o[1]=t?r[t]:l,s=2):2===s&&"..."===l&&t?o[2]=Object.assign(o[2]||{},r[t]):2===s&&l&&!t?(o[2]=o[2]||{})[l]=!0:s>=5&&(5===s?((o[2]=o[2]||{})[n]=t?l?l+r[t]:r[t]:l,s=6):(t||l)&&(o[2][n]+=t?l+r[t]:l)),l=""},d=0;d<t.length;d++){d&&(1===s&&a(),a(d));for(var c=0;c<t[d].length;c++)e=t[d][c],1===s?"<"===e?(a(),o=[o,"",null],s=3):l+=e:4===s?"--"===l&&">"===e?(s=1,l=""):l=e+l[0]:i?e===i?i="":l+=e:'"'===e||"'"===e?i=e:">"===e?(a(),s=1):s&&("="===e?(s=5,n=l,l=""):"/"===e&&(s<5||">"===t[d][c+1])?(a(),3===s&&(o=o[0]),s=o,(o=o[0]).push(this.apply(null,s.slice(1))),s=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(a(),s=2):l+=e),3===s&&"!--"===l&&(s=4,o=o[0])}return a(),o.length>2?o.slice(1):o[1]}.bind((function(t,e,...n){const r=ot[t];return e?r(e,...n):r(...n)}));export{i as defineComponent,it as derive,at as html,tt as reactive,lt as state};
//# sourceMappingURL=apa.min.js.map