let t=(t,e,r)=>{let[s,n]=((t,e)=>{let[r,s]=t.split("|");return[r.trim(),null==s?void 0:s.split(",").map((t=>{let r=t.trim();if(/^\'|^\"|^\`/.test(r)||"$event"===r)return"$event"===r?r:r.slice(1,-1);try{return JSON.parse(r)}catch{return e[r]}}))]})(e.getAttribute(t));if(!s in r.handlers)return;let i=r.handlers[s],a=t.slice(1);n?e.addEventListener(a,(t=>"$event"===n.at(0)?i(t,...n.slice(1)):i(...n))):e.addEventListener(a,i)},e=(e,r)=>{e.getAttributeNames().filter((t=>t.startsWith(":")||"ref"===t)).forEach((s=>{"ref"==s&&((t,e)=>{let r=t.getAttribute("ref");if(r)if(r in e.$refs)if(e.$refs[r]instanceof HTMLElement){let s=e.$refs[r];e.$refs[r]=new Set,e.$refs[r].add(s).add(t)}else e.$refs[r].add(t);else e.$refs[r]=t})(e,r),s.startsWith(":")&&t(s,e,r)}))},r=t=>{let r=r=>{r.filter((e=>(t=>{let e=t.parentElement;for(;(e=e.parentElement)&&!e.tagName.includes("-"););return e})(e.target)==t)).forEach((r=>{if("childList"!==r.type)return;let{addedNodes:s,removedNodes:i}=r;i.length&&i.forEach((e=>{!e.tagName||!e.getAttribute("ref")||((t,e)=>{let r=t.getAttribute("ref");e.$refs[r]instanceof Set?e.$refs[r].delete(t):delete e.$refs[r]})(e,t.ctx)})),s.length&&s.forEach((async r=>{r.tagName&&(e(r,t.ctx),r.childNodes.length>0&&await n(r,t.ctx))}))}))};return new Promise((t=>{t(new MutationObserver(r))}))},s=(t,r)=>{if(!t)return;const n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.getAttributeNames().some((t=>t.startsWith(":")||"ref"===t))?NodeFilter.FILTER_ACCEPT:t.tagName.includes("-")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP});let i=n.currentNode;for(;i=n.nextNode();)e(i,r);null!==t.shadowRoot&&s(t.shadowRoot,r)},n=(t,e)=>new Promise((r=>{s(t,e),r()})),i=(t,e)=>{window.customElements.define(t.tag,class extends HTMLElement{constructor(){super(),this.ctx={onInit:t=>{},onDestroy:()=>{},host:this,$refs:{},handlers:{},watch:(t,e,r)=>{}},t.shadow&&(this.shadow=this.attachShadow({mode:t.shadow})),"function"==typeof t.onConstruct&&t.onConstruct(this)}static get observedAttributes(){return t.observed}connectedCallback(){let t={};this.getAttributeNames().forEach((e=>{let r=this.getAttribute(e);try{t[e]=JSON.parse(r)}catch{t[e]=r}})),this.ctx.props=t,this.ctx.handlers={};let s=this.shadowRoot??this;s.innerHTML=e(this.ctx),(async()=>{await n(this,this.ctx)})();let i={childList:!0,subtree:!0};r(this).then((t=>{this.shadowRoot&&t.observe(this.shadowRoot,i),t.observe(this,i),this.ctx.onInit(s)}))}attributeChangedCallback(t,e,r){this.ctx.watch(t,e,r)}disconnectedCallback(){this.ctx.onDestroy()}})},{isArray:a}=Array,o=(t,...e)=>{let r=e.map((t=>t instanceof HTMLElement?t.outerHTML:a(t)?t.join(" "):t));return t.reduce(((t,e,s)=>t+e+(r[s]??"")),"")},l=null,c=new WeakMap;class h{constructor(t){this.cb=t,this._set=new Set}unhook(){this._set.forEach((t=>t.delete(this)))}}let d=t=>{l=new h(t),l.cb();let e=l;return l=null,e},f=t=>{let e=(t=>{if(Array.isArray(t)||"function"!=typeof t&&"object"!=typeof t)return{val:t};if("function"==typeof t){let e=f(1);return d((()=>e.val=t())),e}return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,"object"==typeof e||"function"==typeof e?f(e):e])))})(t);return new Proxy(e,{get:(t,e,r)=>(((t,e)=>{if(null===l)return;let r;c.has(t)?r=c.get(t).get(e):c.set(t,new Map([[e,r=new Set]])),l._set.add(r),r.add(l)})(t,e),Reflect.get(t,e,r)),set:(t,e,r,s)=>(t[e]!==r&&(Reflect.set(t,e,r,s),((t,e)=>{c.get(t)&&c.get(t).get(e).forEach((({cb:t})=>t()))})(t,e)),!0)})};export{i as define,d as hook,o as html,f as stream};
//# sourceMappingURL=apa.min.js.map